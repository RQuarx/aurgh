name: AURGH Build

on:
  push:
    paths:
      - '**/meson.build'
      - '**/meson_options.txt'
      - '**/*.meson'
      - '.github/workflows/*.yml'
      - '**/*.jsonc'
      - '**/*.json'
      - '**/*.cc'
      - '**/*.hh'

permissions:
  contents: read

jobs:
  clang:
    name: "Build AURGH - clang"
    runs-on: ubuntu-latest
    container:
      image: alpine:latest
    steps:
      - uses: actions/checkout@v4

      - name: Install dependencies
        shell: sh
        run: |
          apk update
          apk add --no-cache \
            build-base \
            cmake \
            meson \
            clang \
            lld \
            gtkmm3-dev \
            glibmm-dev \
            pkgconf \
            python3 \
            py3-pip \
            git

      - name: compile
        shell: sh
        run: |
          CXX=clang++ CXX_LD=lld meson setup target
          meson compile -C target

  gcc:
    name: "Build AURGH - gcc"
    runs-on: ubuntu-latest
    container:
      image: alpine:latest
    steps:
      - uses: actions/checkout@v4

      - name: Install dependencies
        shell: sh
        run: |
          apk update
          apk add --no-cache \
            build-base \
            cmake \
            meson \
            clang \
            lld \
            gtkmm3-dev \
            glibmm-dev \
            pkgconf \
            python3 \
            py3-pip \
            git

      - name: compile
        shell: sh
        run: |
          CXX=g++ CXX_LD=bfd meson setup target
          meson compile -C target